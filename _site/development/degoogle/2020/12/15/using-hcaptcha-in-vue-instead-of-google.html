<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Using hCaptcha instead of Google's ReCaptcha with Vue and Express</title>
    <!-- Tailwind CSS Browser Build -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.4.0/dist/typography.min.css"
    />
  </head>
  <body class="bg-gray-100 text-gray-900 antialiased">
    <!-- Header -->
    <header class="bg-gradient-to-r from-gray-300 to-gray-200 text-gray-800">
      <div
        class="max-w-6xl mx-auto px-6 py-4 flex flex-col sm:flex-row items-center justify-between"
      >
        <h1 class="text-3xl font-bold">
          <a href="/">Quick Thoughts</a>
        </h1>
        <nav class="mt-4 sm:mt-0">
          <ul class="flex flex-wrap space-x-4">
            
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-8"><article
  class="max-w-2xl mx-auto my-12 bg-white shadow-lg rounded-xl overflow-hidden"
>
  <!-- Post Header -->
  <header class="bg-gradient-to-r from-blue-300 to-blue-600 p-8 text-white">
    <h1 class="text-4xl font-extrabold tracking-tight">Using hCaptcha instead of Google's ReCaptcha with Vue and Express</h1>
    <p class="mt-2 text-base">
      Published on
      <time datetime="2020-12-15">
        December 15, 2020
      </time>
      
        in 
        
          <a
            href="/categories/development"
            class="inline-block ml-1 px-2 py-0.5 bg-blue-700 rounded text-xs font-medium hover:bg-blue-800"
          >
            development
          </a>
          , 
        
          <a
            href="/categories/degoogle"
            class="inline-block ml-1 px-2 py-0.5 bg-blue-700 rounded text-xs font-medium hover:bg-blue-800"
          >
            degoogle
          </a>
          , 
        
      
    </p>
  </header>

  <!-- Post Content -->
  <div class="prose max-w-none p-8"><p>For much the same reasons as my last <a href="/development/opinion/2020/03/06/google-captcha-express-js.html">captcha related post</a>, when needing a form of bot deterrence, it makes sense to use a captcha provider. At <a href="https://fixed.link">fixed.link</a> we use it to gate registrations and no-account shortened URLs to help remove some risk of spam. To quickly sum it up, using a provider allows for an easy means of stopping most bots abilities to interact with an application.</p>

<p>Historically, implementing a useful, and not-too-impossible challenge-test was difficult and chalk-full of issues (accessibility, language, buggy). With that said, there is no excuse into todays world to rely on a privacy-invading, ad-selling organization like Google for such a tool. This is where <a href="https://hCaptcha.com/?r=1d541b532693">hCaptcha</a> comes in. Please note that I’ve used my referral link to hCaptcha (although it remains unknown what that actually provides me, but just fyi).</p>

<p>hCaptcha actually pays for the privilege of servings its challenges on your application, which is obviously a nice touch compared to ReCaptcha. As for scale and performance, <a href="https://blog.cloudflare.com/moving-from-recaptcha-to-hcaptcha/">giants like cloudflare</a> use it for their DDOS protection, so I’d doubt you’d run into scalability issues.</p>

<p>Changing providers couldn’t be more straightforward as hCaptcha allows for a direct drop-in replacement for most of <a href="https://developers.google.com/recaptcha/">Google ReCaptcha’s</a> API and features. Furthermore, hCaptcha and the community <a href="https://github.com/hCaptcha">provide libraries</a> for both frontend and backend environments, meaning its extremely easy to integrate and include as a dependency.</p>

<p>As for how to implement a captcha service effectively, it needs to be implemented <em>around</em> frontend interactions and verified on the backend. That is, gate your expensive interaction (i.e. registering for an account) that triggers the challenge, and shoot a request to your normal API endpoint after the user completes the test. From there, the server confirms with hCaptcha that the generated frontend token is valid and then carry on with processing the request normally. This acts as a pass/no-pass middleware before the actual requested endpoint is hit.</p>

<p>For this article, I’ll be using <a href="https://github.com/hCaptcha/vue-hcaptcha">vue-hcaptcha</a> which is a simple wrapper of their JS API with all the necessary vue-ification (e.g. events) that make it easy to drop in a Vue application. As for the backend, I’ve decided to use a <a href="https://github.com/vastus/node-hcaptcha">community package</a> for Node. Again, this package is also a very simple wrapper (it literally has one function that makes a http request to hCaptcha’s <code class="language-plaintext highlighter-rouge">/verify</code> endpoint), but done well, with zero external dependancies - so no point rewriting whats already implemented!</p>

<h2 id="using-hcaptcha-in-a-vue-app">Using hCaptcha in a Vue app</h2>

<p>The <a href="https://github.com/hCaptcha/vue-hcaptcha">documentation</a> for the Vue library is useful, as is the general <a href="https://docs.hcaptcha.com/">documentation</a> provided by hCaptcha for the service itself! Setting up is simply done by pluging in your secret key</p>

<h3 id="the-frontend-setup">The frontend setup</h3>

<p>First, install the library!</p>

<p><code class="language-plaintext highlighter-rouge">npm install @hcaptcha/vue-hcaptcha --save</code></p>

<p>Next grab your <em>sitekey</em> and throw it in your <code class="language-plaintext highlighter-rouge">.env</code> file of choice. Note that for dev, its likely you’d want to use <code class="language-plaintext highlighter-rouge">10000000-ffff-ffff-ffff-000000000001</code> so you don’t need to actually answer your challenges.</p>

<pre><code class="language-env">VUE_APP_HCAPTCHA_SITEKEY=10000000-ffff-ffff-ffff-000000000001
</code></pre>

<h3 id="using-the-hcaptcha-component">Using the hCaptcha component</h3>

<p>Finally, using the library. In the component you want to gate (e.g. a form), add in the hcaptcha component. Check out this exammple below.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span> <span class="kd">class</span><span class="o">=</span><span class="dl">"</span><span class="s2">formContainer</span><span class="dl">"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">vue</span><span class="o">-</span><span class="nx">hcaptcha</span>
      <span class="nx">ref</span><span class="o">=</span><span class="dl">"</span><span class="s2">importantButton</span><span class="dl">"</span>
      <span class="p">:</span><span class="nx">sitekey</span><span class="o">=</span><span class="dl">"</span><span class="s2">VUE_APP_HCAPTCHA_SITEKEY</span><span class="dl">"</span>
      <span class="nx">theme</span><span class="o">=</span><span class="dl">"</span><span class="s2">dark</span><span class="dl">"</span>
      <span class="nx">size</span><span class="o">=</span><span class="dl">"</span><span class="s2">invisible</span><span class="dl">"</span>
      <span class="p">@</span><span class="nd">verify</span><span class="o">=</span><span class="dl">"</span><span class="s2">onCallback</span><span class="dl">"</span>
      <span class="p">@</span><span class="nd">expired</span><span class="o">=</span><span class="dl">"</span><span class="s2">onExpire</span><span class="dl">"</span>
      <span class="p">@</span><span class="nd">error</span><span class="o">=</span><span class="dl">"</span><span class="s2">onError</span><span class="dl">"</span>
    <span class="o">/&gt;</span>

    <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">importantForm</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">b</span><span class="o">-</span><span class="nx">input</span>
          <span class="nx">v</span><span class="o">-</span><span class="nx">model</span><span class="o">=</span><span class="dl">"</span><span class="s2">juicyData</span><span class="dl">"</span>
          <span class="nx">placeholder</span><span class="o">=</span><span class="dl">"</span><span class="s2">Put info here</span><span class="dl">"</span>
        <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="nx">button</span>
        <span class="p">@</span><span class="nd">click</span><span class="o">=</span><span class="dl">"</span><span class="s2">onSubmit</span><span class="dl">"</span>
      <span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">Me</span><span class="o">&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/template</span><span class="err">&gt;
</span></code></pre></div></div>

<p>Wow thats a lot of stuff. But in reality, just a form with an input and a button. The fun stuff is the <code class="language-plaintext highlighter-rouge">&lt;vue-hcaptcha /&gt;</code> component. Attached to that component are the events provided by the library. But before we get there, we need to handle the submit! In this case, just a simple button with a method <code class="language-plaintext highlighter-rouge">onSubmit()</code>.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
<span class="k">import</span> <span class="nx">VueHcaptcha</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@hcaptcha/vue-hcaptcha</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
  <span class="na">components</span><span class="p">:</span> <span class="p">{</span>
    <span class="nx">VueHcaptcha</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="nf">data</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">juicyData</span><span class="p">:</span> <span class="dl">''</span><span class="p">,</span>
      <span class="na">VUE_APP_HCAPTCHA_SITEKEY</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VUE_APP_HCAPTCHA_SITEKEY</span><span class="p">,</span>
    <span class="p">};</span>
  <span class="p">},</span>
  <span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
    <span class="nf">onSubmit</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// hit the captcha components .execute() method, which does all the heavy lifting</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">importantButton</span><span class="p">.</span><span class="nf">execute</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nf">onCallback</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">captcha</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span> <span class="c1">// get the token from the successful challenge</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="dl">'</span><span class="s1">makeAsyncRequest</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="c1">// eg fetch(`/endpoint`, {payload})</span>
        <span class="na">captcha</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">captcha</span><span class="p">,</span>
        <span class="na">juicyData</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">juicyData</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="nf">onExpire</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// example of handling expired captcha</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$store</span><span class="p">.</span><span class="nf">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">SET_ERROR</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Captcha expired. Please try again.</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nf">onError</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// do something with the error</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div>

<p>Wow again, even more code to read… but again, it’s mostly easy stuff.</p>

<p>To start, set the sitekey via <code class="language-plaintext highlighter-rouge">process.env.VUE_APP_HCAPTCHA_SITEKEY</code> in <code class="language-plaintext highlighter-rouge">data</code>, this gives us access to, well, the sitekey.</p>

<p>Next, recall the <code class="language-plaintext highlighter-rouge">$ref</code> on the hcaptcha component, we reference that in the <code class="language-plaintext highlighter-rouge">onSubmit</code> method, and that works its magic, setting up the challenge and all that goodness.</p>

<p>From there, we attach some methods to handle the events passed back from the hCaptcha component. Very self explaintory, with the important event being handled by <code class="language-plaintext highlighter-rouge">onCallback(response)</code>. This is where we make the request to our backend, and verify the challenge is actually genuine.</p>

<h3 id="setting-up-the-express-application-backend">Setting up the Express application (backend)</h3>

<p>We need to be able to parse the request, grab the token value, and then shoot out a call to the hCaptcha service and see if the request can be trusted. Set the <code class="language-plaintext highlighter-rouge">HCAPTCHA_SECRET</code> in the server’s <code class="language-plaintext highlighter-rouge">.env</code>.</p>

<p>In Express, a simple middleware that can parse and shootout a request to the service is just what the Doctor ordered. It provides a portable way to pick and choose which routes need to be validated, and allows an easy way to reject requests. In <code class="language-plaintext highlighter-rouge">verification.js</code> we’ll create this middleware.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">HCAPTCHA_SECRET</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HCAPTCHA_SECRET</span><span class="p">;</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">verify</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">hcaptcha</span><span class="dl">"</span><span class="p">);</span>
<span class="cm">/**
 * Validate client facing Captcha request.
 */</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">async</span> <span class="kd">function</span> <span class="nf">verifyCaptcha</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// get captcha token from body</span>
  <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">[</span><span class="dl">"</span><span class="s2">captcha</span><span class="dl">"</span><span class="p">];</span>
  <span class="c1">// request verification</span>
  <span class="k">await</span> <span class="nf">verify</span><span class="p">(</span><span class="nx">HCAPTCHA_SECRET</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nf">next</span><span class="p">())</span> <span class="c1">//passed, so go forward</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nf">next</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span> <span class="c1">//oh no, bad, handle accordingly</span>
    <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>The function grabs the token from the form, shoots a POST request to hCaptcha, and then checks if its successful and returns a high enough score to continue on to the next step.</p>

<p>A route looks very familiar, just add the middleware, and bingo-bango. Here’s an example,</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span> <span class="nx">verifyCaptcha</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">../middleware/verification</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">router</span><span class="p">.</span><span class="nf">route</span><span class="p">(</span><span class="dl">"</span><span class="s2">/register</span><span class="dl">"</span><span class="p">).</span><span class="nf">post</span><span class="p">(</span><span class="nx">verifyCaptcha</span><span class="p">,</span> <span class="nx">handleRegistration</span><span class="p">);</span>
</code></pre></div></div>

<p>And that’s it! A really straightforward way to provide some protection and judge user interactions. If you’d like to see it in the wild, check out <a href="https://fixed.link">fixed.link</a>, manage URLs and own your links! Its a free URL management service (with free URL shortening).</p>
</div>

  <!-- Post Footer -->
  <footer class="bg-gray-50 p-8 border-t">
    
      <div class="text-sm text-gray-600">
        <span class="font-semibold">Tags:</span>
        
          <a
            href="/tags/vue"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            vue
          </a>
          ,
        
          <a
            href="/tags/captcha"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            captcha
          </a>
          ,
        
          <a
            href="/tags/node"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            node
          </a>
          ,
        
          <a
            href="/tags/web-development"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            web-development
          </a>
          ,
        
          <a
            href="/tags/programming"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            programming
          </a>
          ,
        
          <a
            href="/tags/google"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            google
          </a>
          
        
      </div>
    
  </footer>
</article>
</main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
      <div class="max-w-6xl mx-auto px-6 py-4 text-center">
        <p class="text-sm">
          &copy; 2025 Quick Thoughts. All rights
          reserved.
        </p>
      </div>
    </footer>
  </body>
</html>
