<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Build a URL Shortener with Node + Mongo</title>
    <!-- Tailwind CSS Browser Build -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.4.0/dist/typography.min.css"
    />
  </head>
  <body class="bg-gray-100 text-gray-900 antialiased">
    <!-- Header -->
    <header class="bg-gradient-to-r from-gray-300 to-gray-200 text-gray-800">
      <div
        class="max-w-6xl mx-auto px-6 py-4 flex flex-col sm:flex-row items-center justify-between"
      >
        <h1 class="text-3xl font-bold">
          <a href="/">Quick Thoughts</a>
        </h1>
        <nav class="mt-4 sm:mt-0">
          <ul class="flex flex-wrap space-x-4">
            
          </ul>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-6 py-8"><article
  class="max-w-2xl mx-auto my-12 bg-white shadow-lg rounded-xl overflow-hidden"
>
  <!-- Post Header -->
  <header class="bg-gradient-to-r from-blue-300 to-blue-600 p-8 text-white">
    <h1 class="text-4xl font-extrabold tracking-tight">Build a URL Shortener with Node + Mongo</h1>
    <p class="mt-2 text-base">
      Published on
      <time datetime="2022-02-13">
        February 13, 2022
      </time>
      
        in 
        
          <a
            href="/categories/development"
            class="inline-block ml-1 px-2 py-0.5 bg-blue-700 rounded text-xs font-medium hover:bg-blue-800"
          >
            development
          </a>
          , 
        
          <a
            href="/categories/opinion"
            class="inline-block ml-1 px-2 py-0.5 bg-blue-700 rounded text-xs font-medium hover:bg-blue-800"
          >
            opinion
          </a>
          , 
        
      
    </p>
  </header>

  <!-- Post Content -->
  <div class="prose max-w-none p-8"><p>A while back, long before tonight, I built a <a href="https://nodejs.org/en/">Node.js</a> application called <a href="https://lyt.haus">Lyt.Haus</a> that shortened URLs. Conceptually, it’s simple and not exactly groundbreaking—there are hundreds, if not thousands, of sites offering similar functionality. So, why did I bother investing the time? Simply put, I wanted to tackle a project with a realistic goal that I could build from scratch within a manageable timeframe and, ultimately, use myself (and others).</p>

<p>Looking back, I think it was a great use of my time. It allowed me to dive deep into a full JavaScript/typescript stack while providing real-world experience building a new application from scratch. I’d recommend any developer, beginner or expert programmer alike, looking for learn fast to give it a shot.</p>

<h2 id="the-magic-sauce">The Magic Sauce</h2>

<p>I’ll skip over the usual project setup and environment-specific details and jump into the code. But first, let’s orient ourselves with a file overview:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">views</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">index.ejs</code></li>
      <li><code class="language-plaintext highlighter-rouge">accounts.ejs</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">routes</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">index.js</code></li>
      <li><code class="language-plaintext highlighter-rouge">accounts.js</code></li>
      <li><code class="language-plaintext highlighter-rouge">users.js</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">models</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">users.js</code></li>
      <li><code class="language-plaintext highlighter-rouge">urls.js</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">app.js</code></li>
  <li><code class="language-plaintext highlighter-rouge">middleware</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">permissions.js</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">credentials</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">secretstuff.js</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">package.json</code></li>
</ul>

<p>It’s a fairly straightforward layout, based on the classic MVC pattern. Since my first attempt at this project didn’t involve Vue, I used a templating engine native to Express. I opted for EJS over Pug/Jade because I preferred the syntax, though Pug is definitely more common.</p>

<p>The <code class="language-plaintext highlighter-rouge">routes</code> and <code class="language-plaintext highlighter-rouge">models</code> directories are the core of this application. The models are straightforward. Using MongoDB makes development very flexible. Here’s what a shortened URL looks like as a schema:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// models/urls.js - a schema for shortened URLs</span>

<span class="kd">let</span> <span class="nx">mongoose</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mongoose</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">uniqueValidator</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mongoose-unique-validator</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Schema</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nx">Schema</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">safeBase</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">urlsafe-base64</span><span class="dl">"</span><span class="p">);</span> <span class="c1">// Need special Base64 for URL friendliness (slashes omitted)</span>

<span class="c1">// Create a schema for our links</span>
<span class="kd">let</span> <span class="nx">urlSchema</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Schema</span><span class="p">({</span>
  <span class="na">_id</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">index</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">long_url</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">short_url</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="na">trim</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">index</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">unique</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">sparse</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">date</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">Date</span><span class="p">,</span>
    <span class="na">default</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">count</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Simple analytics for tracking clicks to the long URL from the short URL</span>
    <span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span>
    <span class="na">required</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">categories</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="c1">// Allows users to add a list of categories to the URL for their dashboard</span>
      <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
      <span class="na">ref</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Url.categories.name</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">});</span>

<span class="nx">urlSchema</span><span class="p">.</span><span class="nf">plugin</span><span class="p">(</span><span class="nx">uniqueValidator</span><span class="p">);</span> <span class="c1">// Include the plugin to validate record uniqueness</span>
</code></pre></div></div>

<p>There’s nothing particularly special about the URL records; the schema defines the basic required information.</p>

<p>Now for the secret sauce — how the shortener actually functions. There are two parts. First, we define a counter schema, a record that updates and counts how many URLs have been shortened. Here’s that schema:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">CounterSchema</span> <span class="o">=</span> <span class="nc">Schema</span><span class="p">({</span>
  <span class="na">_id</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="na">required</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span>
  <span class="na">seq</span><span class="p">:</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nb">Number</span><span class="p">,</span> <span class="na">default</span><span class="p">:</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">});</span>
<span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="nx">mongoose</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span><span class="dl">"</span><span class="s2">counter</span><span class="dl">"</span><span class="p">,</span> <span class="nx">CounterSchema</span><span class="p">);</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">seq</code> attribute is incremented for every new URL. It’s a centralized place to record and generate the next unique (and short) identifier. It also allows for the potential to create a more complicated URL shortener that can tie into user accounts, specific domains, etc. But for now, it just counts.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">urlSchema</span><span class="p">.</span><span class="nf">pre</span><span class="p">(</span><span class="dl">"</span><span class="s2">save</span><span class="dl">"</span><span class="p">,</span> <span class="nf">function </span><span class="p">(</span><span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">counter</span><span class="p">.</span><span class="nf">findByIdAndUpdate</span><span class="p">(</span>
    <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">entityId</span><span class="dl">"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">$inc</span><span class="p">:</span> <span class="p">{</span> <span class="na">seq</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">upsert</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">new</span><span class="p">:</span> <span class="kc">false</span> <span class="p">},</span>
    <span class="nf">function </span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">counter</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="kd">let</span> <span class="nx">newid</span> <span class="o">=</span> <span class="nx">safeBase</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="nx">Buffer</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">counter</span><span class="p">.</span><span class="nx">seq</span><span class="p">.</span><span class="nf">toString</span><span class="p">()));</span>
      <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">=</span> <span class="nx">newid</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
      <span class="nf">next</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>This is the heart of the process! Here, we translate the counter that we created above into a base64, unique ID that’s also not very long. There are letious ways of doing this, like using the default ID associated with a MongoDB record. However, that ID is a pain to type and, if truncated, isn’t guaranteed to be unique. Moreover, this approach ties the Mongo record’s ID to the short URL ID, making them essentially the same thing—which is convenient and saves space.</p>

<p>All in all, when creating the models for a URL shortener, think simple and rely on native approaches like the one above. This has been a brief overview of what a MongoDB schema can look like. Next, we’ll dive deeper into the routes and the logic behind generating URLs and stopping spammers with Captcha!</p>
</div>

  <!-- Post Footer -->
  <footer class="bg-gray-50 p-8 border-t">
    
      <div class="text-sm text-gray-600">
        <span class="font-semibold">Tags:</span>
        
          <a
            href="/tags/nodejs"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            nodejs
          </a>
          ,
        
          <a
            href="/tags/programming"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            programming
          </a>
          ,
        
          <a
            href="/tags/web-development"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            web-development
          </a>
          ,
        
          <a
            href="/tags/code"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            code
          </a>
          ,
        
          <a
            href="/tags/mongodb"
            class="inline-block ml-2 px-3 py-1 bg-blue-50 text-blue-600 rounded hover:bg-blue-100"
          >
            mongodb
          </a>
          
        
      </div>
    
  </footer>
</article>
</main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
      <div class="max-w-6xl mx-auto px-6 py-4 text-center">
        <p class="text-sm">
          &copy; 2025 Quick Thoughts. All rights
          reserved.
        </p>
      </div>
    </footer>
  </body>
</html>
